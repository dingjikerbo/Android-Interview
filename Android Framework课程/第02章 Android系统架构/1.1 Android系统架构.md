# Android系统架构

### 问题：请你说一下Android的系统架构

![Android系统架构](../images/android-stack_2x.png)

 - Application层，也就是应用层
 - Framework层，这一层大部分用Java写的
 - Library层，这一层大部分都是C/C++写的，主要是虚拟机，还有一些三方库比如SQLite, WebKit
 - Linux内核层，包含Linux内核和一些驱动，比如说蓝牙驱动，Camera驱动等等。

面试官视角：
是想考察你对整个Android平台架构的熟悉程度，

因为一般认真读过android framework代码的人，都或多或少对android的架构有点了解。因为很多模块都是大同小异的，套路都差不多。你即便以前没看到过这个图，你也能说个八九不离十。

要回答这个问题，首先我们要想一想如果我们自己来设计一个Android系统，该怎么能让应用跑起来？
首先应用跑起来最基础的先能执行代码，所以需要一个虚拟机，然后启动进程，展示一个个界面，需要UI系统。
应用之间需要传递数据，所以需要IPC和线程间传递消息

Linux上面都是系统服务，包括组件管理，IPC，内存管理，虚拟机，系统服务分为两层，Java层和Native层，系统服务要和linux打交道，所以肯定要用c++实现，此外要和应用层打交道，所以还要用java层，

底层Linux层，上层c/c++层，再上层是Java层，便于系统调用，再上层就是应用层，然后基于应用开发

我们做的APP，不论用到的蓝牙，相机，说到底都是和系统底层硬件通信，即应用层怎么收到硬件层穿上来的数据，硬件层发送应用层传下来的数据，而硬件层有驱动，驱动在linux层，往上就是hal层，还是c/c++，再往上要封装成java，java层不是单纯的jni而已，而是要考虑到上层方便调用，所以是需要一个framework层的，然后到应用层。

应用层框架最典型的是系统四大组件，Binder通信，还有系统服务，AMS/PMS/WMS之类的

其实画这个图的话你背一下就会了，一般人也能答得八九不离十，那么就很难出彩，给面试官留下一个深刻的印象。如果我是面试官的话，我就希望你能更进一步，举一个例子，以你熟悉的部分，最好和你项目有关系，比如说你做过蓝牙，那就可以对着这个图，讲讲蓝牙的整个流程，是怎么从上到下的。这样呢我就会觉得唉，不错，确实是很熟，而且面试官还会觉得这个人深度不错，一般的人调一下接口就完了，他还会主动去学习底层实现，去钻研一些东西。你不用说的太细，只需要以一个具体的案例来印证这个图上所示的分层架构就好了。你做短视频的，那就讲讲Camera，如果实在没什么讲的，那就讲讲SurfaceFlinger，你的布局是怎么最终显示到屏幕上的，
或者事件，你触摸了屏幕，事件是怎么从驱动层，一步步往上分发到应用层的。其实不论什么模块，流程都是大同小异的。

首先你的手机就是一个硬件，而你的应用就是要调用手机上的硬件资源，来完成各种功能，比如屏幕上显示东西，扬声器发出声音，网络模块发送数据等等。你要是只是想做个简单的玩具，那很容易，直接在linux上，打开这些设备驱动，然后再发起各种调用就好了。但是我们是做Android应用，作为Android设计者，要考虑到怎么给这些底层的资源封装好，让应用层开发起来更容易。那就需要HAL层，Native层需要做一些事，比如要做一些额外的处理，Java层要做一些处理，然后提供接口给应用。这里面肯定涉及到系统服务，需要统一来管理系统资源，就涉及到和系统服务通信，首先执行要虚拟机吧

不熟的就别提，免得面试官刨根问底，可能他刚好对这块了解呢？

### 面试指南
**不及格答法**
应用层，系统框架层，Linux层
应用层，下面是sdk层，然后最后是Linux层

**及格答法**
应用层，系统服务层Java，Native库层，HAL层，Linux层
然后解释各层的主要作用，包含哪些主要元素，比如为什么要HAL层
整体分层思路，为什么要这么分层

**满分答法**
以一个典型的模块为例，来讲整个请求是怎么从上到下跑通的，比如蓝牙，请求是怎么从应用层一步步往下最后发出去的，触类旁通



技巧点拨：
抓住细节，有技巧的回避知识盲区
把握节奏，不要等面试官追问，
主动深入，让面试官了解你的知识体系
触类旁通，让面试官眼前一亮